import nmap
import time

def scan_target(target):
    scanner = nmap.PortScanner()

    print(f"\n++ Starting scan on {target} ++")
    start_time = time.time()
    print("This may take a while, please wait...\n")

# Perform scan with version detection, OS detection, vuln and http scripts
    scanner.scan(
        hosts = target,
        arguments= "-sV --script vuln,http-*",
    )

    end_time = time.time()
    print(f"\n Scan completed in {round(end_time - start_time,2)} seconds\n")

    for host in scanner.all_hosts():
        print(f"\n--- Scan Report for {host} ---")
        print(f"Host is {scanner[host].state()}")

        #OS detection
        if 'osmatch' in scanner[host] and scanner[host]['osmatch']:
            #os_info = scanner[host]['osmatch'][0]
            print(f"OS: {scanner[host]['osmatch'][0]['name']}")
        else:
            print("OS: Not detected")

        for proto in scanner[host].all_protocols():
            print(f"\nProtocol: {proto}")
            ports = scanner[host][proto].keys()
            for port in sorted(ports):
                service = scanner[host][proto][port]
                print(f"Port: {port} | State: {service['state']} | Service: {service['name']}")

                #show script results
                if 'script' in service:
                    for script_name, script_output in service['script'].items():
                        print(f"Script: {script_name} | Output: {script_output}")

    print("\n++ Scan finished ++\n")

if __name__ == "__main__":
    target = input("Enter the target IP or domain to scan: ")
    if target:
        scan_target(target)
    else:
        print("No target specified. Exiting.")
